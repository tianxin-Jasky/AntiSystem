const find=function(e){return document.querySelector(e)},sendMessage=chrome.tabs.sendMessage,onMessage=chrome.runtime.onMessage,query=chrome.tabs.query,container=find("#container"),showAddBtn=find("#showAddBtn"),addArea=find(".add-area"),cancelBtn=find("#cancelBtn"),confirmBtn=find("#confirmBtn"),accountBtnArea=find("#accountBtnArea"),accountNameInput=find("#accountName"),accountInput=find("#account"),passwordInput=find("#password");var socket;const Plugin={initButton:function(){let e=this,t="",n={},o="",a="";for(let c in localStorage)localStorage.hasOwnProperty(c)&&(t=e.getStorage(c),o=(n=JSON.parse(t)).account,a=n.password,e.createButton(c))},bindEvent:function(){let e=this;accountBtnArea.addEventListener("click",function(t){t.stopPropagation();let n=t.target,o=t.target.className,a="",c={};"account-btn"===o?(a=n.parentNode.getAttribute("storage-key"),c=JSON.parse(e.getStorage(a)),e.sendMsg(c.account,c.password)):"fa fa-trash"===o?(a=n.parentNode.parentNode.getAttribute("storage-key"),e.removeStorage(a),location.reload()):console.log("neither account-btn nor delete-btn.")},!1),showAddBtn.addEventListener("click",function(){addArea.style.display="block",showAddBtn.style.display="none"},!1),cancelBtn.addEventListener("click",function(){location.reload()},!1),confirmBtn.addEventListener("click",function(){let t=accountNameInput.value,n=accountInput.value,o=passwordInput.value;if(""===t||""===n||""===o)return void console.info("input incomplete.");let a={account:n,password:o},c=JSON.stringify(a);e.setStorage(t,c),e.clearInput(),location.reload()},!1)},connectServer:function(){let e=this;socket=new WebSocket("ws://192.168.153.245:1234"),console.log("连接服务开始！"),socket.onopen=function(e){console.log("连接服务成功！")},console.log("连接服务结束！");var t="",n="",o="",a="",c=-1;socket.onmessage=function(s){var i=s.data.split("!@#%&");let r={MailNumber:parseInt(i[0])},l=JSON.stringify(r);e.setStorage("!！@@##¥",l);for(var d=1,u=0;d<i.length;d++,u++){switch(u%4){case 0:t=i[d];break;case 1:n=i[d];break;case 2:o=i[d];break;case 3:a=i[d],c++;let s={Mailsubject:t,Mailtime:n,Mailsender:o,Mailjudge:a},r=JSON.stringify(s);e.setStorage(c,r)}}window.location="/MailShield_HTML/result.html"},socket.onclose=function(e){console.log("服务器的关闭")},socket.onerror=function(e){console.log("服务器的连接失败")}},sendMsg:function(e,t){var n=e+"!@#%&"+t;socket.send(n)},showPanel:function(){addArea.style.display="block",showAddBtn.style.display="none"},hidePanel:function(){addArea.style.display="none",showAddBtn.style.display="block"},setStorage:function(e,t){localStorage.setItem(e,t)},getStorage:function(e){return localStorage.getItem(e)},removeStorage:function(e){localStorage.removeItem(e)},clearInput:function(){accountNameInput.value="",accountInput.value="",passwordInput.value=""},createButton:function(e,t,n){let o=document.createElement("div");o.className="button-row",o.setAttribute("storage-key",e);let a=document.createElement("button");a.className="account-btn",a.innerText=e;let c=document.createElement("div");c.className="icon-container";let s=document.createElement("i");s.className="fa fa-trash",c.appendChild(s),o.appendChild(a),o.appendChild(c),accountBtnArea.appendChild(o)},fillTheBlank:function(e,t){query({active:!0,currentWindow:!0},function(n){sendMessage(n[0].id,{action:"FILL_THE_BLANK",account:e,password:t},function(e){console.log(e)})})},init:function(){this.initButton(),this.connectServer(),this.bindEvent()}};Plugin.init();